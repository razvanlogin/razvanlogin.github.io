<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDS+PETIT DEJ // 22/08/2025</title>
    <style>
        body{font-family:'Inter',Arial,sans-serif;max-width:1200px;margin:0 auto;padding:20px;background:#f5f5f5;color:#333;transition:all 0.3s ease}
        h1{text-align:center;margin-bottom:30px;font-size:2.5em;letter-spacing:1px;background:linear-gradient(135deg,#ff3075,#a80022);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
        .controls{text-align:center;margin-bottom:20px;display:flex;justify-content:center;gap:12px;flex-wrap:wrap}
        button{background:#ff3075;color:white;border:none;padding:12px 25px;border-radius:8px;cursor:pointer;font-size:16px;box-shadow:0 4px 8px rgba(0,0,0,0.2);transition:all 0.2s ease;font-weight:500}
        button:hover{background:#a80022;transform:translateY(-2px);box-shadow:0 6px 12px rgba(0,0,0,0.3)}
        button:active{transform:translateY(0);box-shadow:0 2px 4px rgba(0,0,0,0.2)}
        button:disabled{background:#ccc;cursor:not-allowed;transform:none;box-shadow:none}
        .puzzle-container{display:flex;gap:40px;flex-wrap:wrap;justify-content:center;align-items:flex-start}
        .grid-container,.clues-container{background:white;padding:20px;border-radius:12px;box-shadow:0 5px 15px rgba(0,0,0,0.15);transition:all 0.3s ease}
        .grid-container:hover,.clues-container:hover{box-shadow:0 8px 25px rgba(0,0,0,0.2)}
        .crossword-grid{display:grid;grid-template:repeat(9,45px)/repeat(9,45px);gap:1px;background:#333;border:2px solid #333;border-radius:6px;overflow:hidden;position:relative}
        .cell{background:white;border:none;text-align:center;font-size:18px;font-weight:bold;text-transform:uppercase;position:relative;display:flex;align-items:center;justify-content:center;transition:all 0.15s ease;cursor:pointer}
        .cell:not(.blocked):hover{background:#f8f9ff;transform:scale(1.02);z-index:2;box-shadow:0 2px 8px rgba(255,48,117,0.2)}
        .cell:focus{outline:3px solid #ff3075;background:#ffb3cc;z-index:3;transform:scale(1.02)}
        .cell.active{background:#ffb3cc;box-shadow:inset 0 0 0 2px #ff3075}
        .cell.word-highlight{background:#fff3f6}
        .cell.blocked{background:#ff3075;cursor:default;transform:none}
        .cell.blocked:hover{background:#ff3075;transform:none;box-shadow:none}
        .cell.correct{background:#d4edda;border:2px solid #28a745}
        .cell.incorrect{background:#f8d7da;border:2px solid #dc3545;animation:shake 0.5s}
        .cell-number{position:absolute;top:2px;left:3px;font-size:10px;font-weight:bold;color:#555;pointer-events:none;z-index:1;background:rgba(255,255,255,0.9);border-radius:2px;padding:0 2px}
        .clues-container{min-width:350px;max-width:800px;display:flex;flex-direction:row;gap:30px;justify-content:space-between;background:white;padding:20px;border-radius:12px;box-shadow:0 5px 15px rgba(0,0,0,0.15);transition:all 0.3s ease}
        .clues-container:hover{box-shadow:0 8px 25px rgba(0,0,0,0.2)}

        .clues-section{flex:1;margin-bottom:0;min-width:0}

        .clues-section h3{margin-bottom:15px;color:#333;border-bottom:2px solid #ff3075;padding-bottom:5px;font-size:1.3em;display:flex;align-items:center;gap:8px}
        .clues-section h3::before{content:'‚Üí';font-size:1.2em;color:#ff3075}
        .clues-section:last-child h3::before{content:'‚Üì'}
        .clue{margin-bottom:8px;padding:8px 12px;cursor:pointer;border-radius:6px;transition:all 0.2s ease;font-size:14px;line-height:1.4;border-left:3px solid transparent;position:relative}
        .clue:hover{background:#f0f7ff;border-left-color:#ff3075;transform:translateX(4px);box-shadow:0 2px 8px rgba(0,0,0,0.1)}
        .clue.active{background:#ffb3cc;border-left-color:#ff3075;transform:translateX(4px);box-shadow:0 4px 12px rgba(255,48,117,0.3)}
        .clue.completed{background:#e8f5e8;border-left-color:#28a745;opacity:0.8}
        .clue.completed .clue-number{color:#28a745}
        .clue-number{font-weight:bold;color:#ff3075;margin-right:8px;display:inline-block;min-width:20px}
        .progress-bar{width:100%;height:4px;background:#e0e0e0;border-radius:2px;margin:20px 0;overflow:hidden}
        .progress-fill{height:100%;background:linear-gradient(90deg,#ff3075,#a80022);transition:width 0.3s ease;border-radius:2px}
        .stats{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;font-size:14px;color:#666}
        .stat-item{display:flex;flex-direction:column;align-items:center;gap:4px}
        .stat-number{font-size:20px;font-weight:bold;color:#ff3075}
        @keyframes fadeIn{from{opacity:0;transform:translate(-50%,-60%)}to{opacity:1;transform:translate(-50%,-50%)}}
        @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}
        @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
        .confetti{position:fixed;font-size:24px;pointer-events:none;z-index:999;animation:confetti-fall linear infinite}
        @keyframes confetti-fall{0%{transform:translateY(-100vh) rotate(0deg);opacity:1}100%{transform:translateY(100vh) rotate(360deg);opacity:0}}
        .hint-button{background:#28a745;margin-left:8px;padding:8px 16px;font-size:14px}
        .hint-button:hover{background:#218838}
        .timer{font-family:'Courier New',monospace;font-size:18px;font-weight:bold;color:#ff3075}
        .dark-mode{background:#1a1a1a;color:#e0e0e0}
        .dark-mode .grid-container,.dark-mode .clues-container{background:#2d2d2d;color:#e0e0e0}
        .dark-mode .cell{background:#404040;color:#e0e0e0}
        .dark-mode .cell:not(.blocked):hover{background:#4a4a4a}
        .dark-mode .cell.blocked{background:#ff3075;color:white}
        .dark-mode .clue:hover{background:#3a3a3a}
        .theme-toggle{background:#666;font-size:14px;padding:8px 16px}
        .theme-toggle:hover{background:#555}
        @media (max-width: 768px){
            .clues-container{flex-direction:column;gap:20px;max-width:500px}
            .puzzle-container{flex-direction:column;align-items:center;gap:20px}
            .crossword-grid{grid-template:repeat(9,35px)/repeat(9,35px)}
            .cell{font-size:14px}
            h1{font-size:2em}
        }
    </style>
</head>
<body>
    <h1>DDS+PETIT DEJ // 22/08/2025</h1>
    
    <div class="stats">
        <div class="stat-item">
            <div class="stat-number" id="completed-words">0</div>
            <div>Mots Compl√©t√©s</div>
        </div>
        <div class="stat-item">
            <div class="timer" id="timer">00:00</div>
            <div>Temps</div>
        </div>
        <div class="stat-item">
            <div class="stat-number" id="accuracy">100%</div>
            <div>Pr√©cision</div>
        </div>
    </div>
    
    <div class="progress-bar">
        <div class="progress-fill" id="progress" style="width: 0%"></div>
    </div>
    
    <div class="controls">
        <button onclick="clearGrid()">üóëÔ∏è Effacer Tout</button>
        <button onclick="checkAnswers()">‚úì V√©rifier</button>
        <button onclick="giveHint()" class="hint-button">üí° Indice</button>
        <button onclick="toggleTheme()" class="theme-toggle">üåì Th√®me</button>
    </div>
    
    <div class="puzzle-container">
        <div class="grid-container">
            <div class="crossword-grid" id="grid"></div>
        </div>
        <div class="clues-container">
            <div class="clues-section">
                <h3>Horizontalement</h3>
                <div id="across"></div>
            </div>
            <div class="clues-section">
                <h3>Verticalement</h3>
                <div id="down"></div>
            </div>
        </div>
    </div>

    <script>
        const grid = [
            ['J','O','U','G','X','F','K','X','H'],
            ['R','X','B','E','R','L','I','N','E'],
            ['X','R','E','N','A','U','D','X','J'],
            ['H','O','R','I','Z','O','N','S','X'],
            ['Y','S','X','E','V','X','A','I','L'],
            ['D','E','C','X','A','L','P','E','X'],
            ['R','E','X','E','N','X','P','R','O'],
            ['E','X','O','S','X','V','E','R','T'],
            ['S','I','N','X','N','E','X','A','O']
        ];

        const clues = [
            {c:"Attelle pour boeufs",a:"JOUG",r:0,k:0,d:'across'},
            {c:"Fran√ßois Knauf (init.)",a:"FK",r:0,k:5,d:'across'},
            {c:"Voiture confortable, sedan",a:"BERLINE",r:1,k:2,d:'across'},
            {c:"MON PREMIER",a:"RENAUD",r:2,k:1,d:'across'},
            {c:"Lointains visibles",a:"HORIZONS",r:3,k:0,d:'across'},
            {c:"Yves Schindler (init.)",a:"YS",r:4,k:0,d:'across'},
            {c:"Electric vehicle (abbrev.)",a:"EV",r:4,k:3,d:'across'},
            {c:"Condiment en bulbe",a:"AIL",r:4,k:6,d:'across'},
            {c:"D√©cembre (abbrev.)",a:"DEC",r:5,k:0,d:'across'},
            {c:"Montagne fran√ßaise, au singulier",a:"ALPE",r:5,k:4,d:'across'},
            {c:"Note musicale apr√®s Do",a:"RE",r:6,k:0,d:'across'},
            {c:"Anglais (abbrev.)",a:"EN",r:6,k:3,d:'across'},
            {c:"Expert",a:"PRO",r:6,k:6,d:'across'},
            {c:"Operating System (abbrev.)",a:"OS",r:7,k:2,d:'across'},
            {c:"Couleur de la nature",a:"VERT",r:7,k:5,d:'across'},
            {c:"Sinus en math√©matiques",a:"SIN",r:8,k:0,d:'across'},
            {c:"Particule n√©gative",a:"NE",r:8,k:4,d:'across'},
            {c:"Mois d'√©t√© (abbrev.)",a:"AO",r:8,k:7,d:'across'},
            {c:"Junior (abbrev.)",a:"JR",r:0,k:0,d:'down'},
            {c:"Companie de taxi",a:"UBER",r:0,k:2,d:'down'},
            {c:"Tr√®s int√©lligent",a:"GENIE",r:0,k:3,d:'down'},
            {c:"Marqueur jaune",a:"FLUO",r:0,k:5,d:'down'},
            {c:"Enl√®ve discr√®tement",a:"KIDNAPPE",r:0,k:6,d:'down'},
            {c:"\"Salut\" su√©dois",a:"HEJ",r:0,k:8,d:'down'},
            {c:"MON SECOND",a:"RAZVAN",r:1,k:4,d:'down'},
            {c:"Perles du matin",a:"ROSEE",r:2,k:1,d:'down'},
            {c:"Monstres √† plusieurs t√™tes",a:"HYDRES",r:3,k:0,d:'down'},
            {c:"Code radio pour \"S\"",a:"SIERRA",r:3,k:7,d:'down'},
            {c:"Oppos√© de \"OFF\"",a:"ON",r:7,k:2,d:'down'},
            {c:"Espagne (abbrev.)",a:"ES",r:6,k:3,d:'down'},
            {c:"Pr√©fix li√© √† l'oreille",a:"OTO",r:6,k:8,d:'down'},
            {c:"Victor Edouard (init.)",a:"VE",r:7,k:5,d:'down'}
        ];

        let {across,down} = {across:[],down:[]};
        let activeWord = null, direction = null, typing = false;
        let autoCheckEnabled = false, startTime = Date.now(), timerInterval;
        let completedWords = new Set(), incorrectAttempts = 0, totalAttempts = 0;

        function assignNumbers() {
            const positions = clues.map(c => ({r:c.r,k:c.k,d:c.d,c})).sort((a,b) => a.r-b.r || a.k-b.k);
            let num = 1;
            const nums = {};
            
            positions.forEach(p => {
                const key = `${p.r},${p.k}`;
                if (!nums[key]) nums[key] = num++;
                (p.d === 'across' ? across : down).push({n:nums[key], ...p.c});
            });
        }

        function initGrid() {
            const g = document.getElementById('grid');
            g.innerHTML = '';

            for (let r = 0; r < 9; r++) {
                for (let k = 0; k < 9; k++) {
                    const c = document.createElement('input');
                    c.type = 'text';
                    c.maxLength = 1;
                    c.className = 'cell';
                    c.dataset.row = r;
                    c.dataset.col = k;

                    if (grid[r][k] === 'X') {
                        c.disabled = true;
                        c.classList.add('blocked');
                    } else {
                        c.addEventListener('input', handleInput);
                        c.addEventListener('keydown', handleKey);
                        c.addEventListener('focus', handleFocus);
                        c.addEventListener('mousedown', handleMouse);
                        c.addEventListener('mouseenter', handleHover);
                        c.addEventListener('mouseleave', clearHover);
                    }
                    g.appendChild(c);
                }
            }
            addNumbers();
            startTimer();
        }

        function addNumbers() {
            [...across, ...down].forEach(c => {
                const cell = document.querySelector(`[data-row="${c.r}"][data-col="${c.k}"]`);
                if (cell && !cell.querySelector('.cell-number')) {
                    const span = document.createElement('span');
                    span.className = 'cell-number';
                    span.textContent = c.n;
                    cell.appendChild(span);
                }
            });
        }

        function handleInput(e) {
            e.target.value = e.target.value.toUpperCase();
            typing = true;
            totalAttempts++;
            
            // Auto-check is now always enabled
            const r = +e.target.dataset.row, k = +e.target.dataset.col;
            if (e.target.value && e.target.value !== grid[r][k]) {
                e.target.classList.add('incorrect');
                incorrectAttempts++;
                setTimeout(() => e.target.classList.remove('incorrect'), 1000);
            } else if (e.target.value === grid[r][k]) {
                e.target.classList.add('correct');
                setTimeout(() => e.target.classList.remove('correct'), 1000);
            }
            
            if (e.target.value && activeWord) moveNext(e.target);
            updateStats();
            checkWordCompletion();
        }


        function handleKey(e) {
            const c = e.target;
            const r = +c.dataset.row, k = +c.dataset.col;

            switch(e.key) {
                case 'ArrowRight': e.preventDefault(); typing = false; moveCell(r, k + 1); break;
                case 'ArrowLeft': e.preventDefault(); typing = false; moveCell(r, k - 1); break;
                case 'ArrowDown': e.preventDefault(); typing = false; moveCell(r + 1, k); break;
                case 'ArrowUp': e.preventDefault(); typing = false; moveCell(r - 1, k); break;
                case 'Backspace': if (!c.value) { e.preventDefault(); movePrev(c); } break;
                case 'Tab': e.preventDefault(); typing = false; toggle(r, k); break;
                case ' ': e.preventDefault(); typing = false; toggle(r, k); break;
                default: if (e.key.length === 1) typing = true; break;
            }
        }

        function handleFocus(e) {
            // Only auto-select if not already typing in an active word
            if (typing && activeWord) return;
            
            const r = +e.target.dataset.row, k = +e.target.dataset.col;
            
            // If this cell is already part of the active word, don't change selection
            if (activeWord) {
                const isInActiveWord = direction === 'across' ?
                    (activeWord.r === r && k >= activeWord.k && k < activeWord.k + activeWord.a.length) :
                    (activeWord.k === k && r >= activeWord.r && r < activeWord.r + activeWord.a.length);
                
                if (isInActiveWord) return;
            }
            
            // New cell focused - select horizontal first, then vertical
            const aw = findWord(r, k, 'across'), dw = findWord(r, k, 'down');
            if (aw) {
                highlight(aw, 'across');
            } else if (dw) {
                highlight(dw, 'down');
            } else {
                clearHL();
            }
        }


        function handleMouse(e) {
            const c = e.target, r = +c.dataset.row, k = +c.dataset.col;
            const aw = findWord(r, k, 'across'), dw = findWord(r, k, 'down');
            
            // If clicking on the same cell that's already focused
            if (document.activeElement === c && activeWord) {
                e.preventDefault();
                typing = false;
                // Cycle between available directions
                if (aw && dw) {
                    direction = direction === 'across' ? 'down' : 'across';
                    highlight(direction === 'across' ? aw : dw, direction);
                }
                return;
            }
            
            // New cell clicked - clear old selection and select new
            typing = false;
            if (aw) {
                highlight(aw, 'across');
            } else if (dw) {
                highlight(dw, 'down');
            } else {
                clearHL();
            }
        }

        function handleHover(e) {
            if (activeWord) return;
            const r = +e.target.dataset.row, k = +e.target.dataset.col;
            const aw = findWord(r, k, 'across'), dw = findWord(r, k, 'down');
            const word = aw || dw;
            if (word) {
                const dir = aw ? 'across' : 'down';
                highlightWord(word, dir, 'word-highlight');
            }
        }

        function clearHover() {
            if (activeWord) return;
            document.querySelectorAll('.word-highlight').forEach(e => e.classList.remove('word-highlight'));
        }

        function highlightWord(w, d, className = 'active') {
            for (let i = 0; i < w.a.length; i++) {
                const cr = d === 'across' ? w.r : w.r + i;
                const ck = d === 'across' ? w.k + i : w.k;
                const cell = document.querySelector(`[data-row="${cr}"][data-col="${ck}"]`);
                if (cell) cell.classList.add(className);
            }
        }

        function toggle(r, k) {
            const aw = findWord(r, k, 'across'), dw = findWord(r, k, 'down');
            if (aw && dw) {
                direction = direction === 'across' ? 'down' : 'across';
                highlight(direction === 'across' ? aw : dw, direction);
            } else if (aw) highlight(aw, 'across');
            else if (dw) highlight(dw, 'down');
        }

        function findWord(r, k, d) {
            return (d === 'across' ? across : down).find(w => {
                if (d === 'across') {
                    const end = w.k + w.a.length - 1;
                    return w.r === r && k >= w.k && k <= end;
                } else {
                    const end = w.r + w.a.length - 1;
                    return w.k === k && r >= w.r && r <= end;
                }
            });
        }

        function moveCell(r, k) {
            if (r >= 0 && r < 9 && k >= 0 && k < 9) {
                const c = document.querySelector(`[data-row="${r}"][data-col="${k}"]`);
                if (c && !c.disabled) c.focus();
            }
        }

        function moveNext(c) {
            if (!activeWord) return;
            const r = +c.dataset.row, k = +c.dataset.col;
            const len = activeWord.a.length;

            if (direction === 'across') {
                const end = activeWord.k + len - 1;
                for (let nk = k + 1; nk <= end; nk++) {
                    const nc = document.querySelector(`[data-row="${r}"][data-col="${nk}"]`);
                    if (nc && !nc.value) { nc.focus(); return; }
                }
            } else {
                const end = activeWord.r + len - 1;
                for (let nr = r + 1; nr <= end; nr++) {
                    const nc = document.querySelector(`[data-row="${nr}"][data-col="${k}"]`);
                    if (nc && !nc.value) { nc.focus(); return; }
                }
            }
        }

        function movePrev(c) {
            if (!activeWord) return;
            const r = +c.dataset.row, k = +c.dataset.col;
            if (direction === 'across') {
                if (k > activeWord.k) moveCell(r, k - 1);
            } else {
                if (r > activeWord.r) moveCell(r - 1, k);
            }
        }

        function highlight(w, d) {
            clearHL();
            activeWord = w;
            direction = d;
            highlightWord(w, d);

            const clue = document.querySelector(`.clue[data-n="${w.n}"][data-d="${d}"]`);
            if (clue) {
                clue.classList.add('active');
                clue.scrollIntoView({behavior:'smooth',block:'nearest'});
            }
        }

        function clearHL() {
            document.querySelectorAll('.active, .word-highlight').forEach(e => e.classList.remove('active', 'word-highlight'));
            document.querySelectorAll('.clue.active').forEach(e => e.classList.remove('active'));
            activeWord = null;
            direction = null;
        }

        function createClues() {
            const ac = document.getElementById('across'), dc = document.getElementById('down');
            ac.innerHTML = dc.innerHTML = '';

            const create = (cs, container, d) => {
                [...cs].sort((a,b) => a.n - b.n).forEach(c => {
                    const div = document.createElement('div');
                    div.className = 'clue';
                    div.dataset.n = c.n;
                    div.dataset.d = d;
                    div.innerHTML = `<span class="clue-number">${c.n}.</span> ${c.c}`;
                    div.addEventListener('click', () => {
                        typing = false;
                        const cell = document.querySelector(`[data-row="${c.r}"][data-col="${c.k}"]`);
                        if (cell) { cell.focus(); highlight(c, d); }
                    });
                    container.appendChild(div);
                });
            };

            create(across, ac, 'across');
            create(down, dc, 'down');
        }

        function checkWordCompletion() {
            [...across, ...down].forEach(word => {
                let isComplete = true;
                for (let i = 0; i < word.a.length; i++) {
                    const r = word.d === 'across' ? word.r : word.r + i;
                    const k = word.d === 'across' ? word.k + i : word.k;
                    const cell = document.querySelector(`[data-row="${r}"][data-col="${k}"]`);
                    if (!cell || cell.value !== word.a[i]) {
                        isComplete = false;
                        break;
                    }
                }
                
                const clue = document.querySelector(`.clue[data-n="${word.n}"][data-d="${word.d}"]`);
                const wordKey = `${word.n}-${word.d}`;
                
                if (isComplete && !completedWords.has(wordKey)) {
                    completedWords.add(wordKey);
                    if (clue) clue.classList.add('completed');
                } else if (!isComplete && completedWords.has(wordKey)) {
                    completedWords.delete(wordKey);
                    if (clue) clue.classList.remove('completed');
                }
            });
        }

        function updateStats() {
            document.getElementById('completed-words').textContent = completedWords.size;
            const accuracy = totalAttempts > 0 ? Math.round(((totalAttempts - incorrectAttempts) / totalAttempts) * 100) : 100;
            document.getElementById('accuracy').textContent = accuracy + '%';
            
            const progress = (completedWords.size / clues.length) * 100;
            document.getElementById('progress').style.width = progress + '%';
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                document.getElementById('timer').textContent =
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function clearGrid() {
            document.querySelectorAll('.cell:not(.blocked)').forEach(c => {
                c.value = '';
                c.classList.remove('correct', 'incorrect');
            });
            clearHL();
            typing = false;
            completedWords.clear();
            document.querySelectorAll('.clue').forEach(c => c.classList.remove('completed'));
            updateStats();
        }

        function checkAnswers() {
            let complete = true, correct = 0, total = 0;
            
            for (let r = 0; r < 9; r++) {
                for (let k = 0; k < 9; k++) {
                    if (grid[r][k] !== 'X') {
                        total++;
                        const c = document.querySelector(`[data-row="${r}"][data-col="${k}"]`);
                        if (!c || !c.value) {
                            complete = false;
                        } else if (c.value === grid[r][k]) {
                            correct++;
                            c.classList.add('correct');
                            setTimeout(() => c.classList.remove('correct'), 2000);
                        } else {
                            complete = false;
                            c.classList.add('incorrect');
                            setTimeout(() => c.classList.remove('incorrect'), 2000);
                        }
                    }
                }
            }
            
            showResult(complete, correct, total);
        }

        let hintCount = 0;

        function giveHint() {
             if (hintCount >= 3) {
                 alert("Vous avez utilis√© les 3 indices!");
                 return;
             }

             const emptyCells = [];
             for (let r = 0; r < 9; r++) {
                 for (let k = 0; k < 9; k++) {
                     if (grid[r][k] !== 'X') {
                         const cell = document.querySelector(`[data-row="${r}"][data-col="${k}"]`);
                         if (!cell || !cell.value || cell.value !== grid[r][k]) {
                             emptyCells.push({r, k, cell});
                         }
                     }
                 }
             }

             if (emptyCells.length > 0) {
                 const randomCell = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                 randomCell.cell.value = grid[randomCell.r][randomCell.k];
                 randomCell.cell.classList.add('correct');
                 randomCell.cell.style.animation = 'pulse 0.5s';
                 setTimeout(() => {
                     randomCell.cell.classList.remove('correct');
                     randomCell.cell.style.animation = '';
                 }, 1000);
                 hintCount++;
                 checkWordCompletion();
                 updateStats();
             }
         }


     

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark);
        }

        function confetti() {
            const emojis = ['üéâ','üéä','‚ú®','üéà','üéÅ','üåü','üí´','üé≠','üèÜ','üé™'];
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const c = document.createElement('div');
                    c.className = 'confetti';
                    c.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    c.style.left = Math.random() * 100 + 'vw';
                    c.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    c.style.animationDelay = Math.random() + 's';
                    c.style.fontSize = (Math.random() * 12 + 18) + 'px';
                    document.body.appendChild(c);
                    setTimeout(() => c.remove(), 6000);
                }, i * 100);
            }
        }

        function showResult(complete, correct = 0, total = 0) {
            const box = document.createElement('div');
            box.style.cssText = `position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;padding:30px;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,0.3);z-index:1000;text-align:center;font-size:1.2em;animation:fadeIn 0.3s;max-width:400px;border:3px solid #ff3075`;
            
            if (complete) {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                const timeStr = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                const accuracy = totalAttempts > 0 ? Math.round(((totalAttempts - incorrectAttempts) / totalAttempts) * 100) : 100;
                
                box.innerHTML = `
                    <div style="background:linear-gradient(135deg,#ff3075,#a80022);color:white;margin:-30px -30px 20px -30px;padding:20px;border-radius:12px 12px 0 0;">
                        <h2 style="margin:0;font-size:1.5em;">üéâ F√âLICITATIONS ! üéâ</h2>
                    </div>
                    <p><strong>Puzzle compl√©t√© √† 100% !</strong></p>
                    <div style="display:flex;justify-content:space-around;margin:20px 0;font-size:0.9em;">
                        <div><strong>‚è±Ô∏è Temps:</strong><br>${timeStr}</div>
                        <div><strong>üéØ Pr√©cision:</strong><br>${accuracy}%</div>
                        <div><strong>‚úÖ Mots:</strong><br>${completedWords.size}/${clues.length}</div>
                    </div>
                    <button onclick="this.parentNode.remove()" style="background:#ff3075;color:white;border:none;padding:12px 24px;border-radius:8px;cursor:pointer;font-size:16px;margin-top:15px;font-weight:bold;box-shadow:0 4px 8px rgba(0,0,0,0.2)">üèÜ Fermer</button>
                `;
                confetti();
                clearInterval(timerInterval);
            } else {
                const percentage = total > 0 ? Math.round((correct / total) * 100) : 0;
                box.innerHTML = `
                    <div style="background:#dc3545;color:white;margin:-30px -30px 20px -30px;padding:20px;border-radius:12px 12px 0 0;">
                        <h3 style="margin:0;">‚ùå Pas encore fini !</h3>
                    </div>
                    <p>La grille contient encore des erreurs ou des cases vides.</p>
                    <div style="margin:15px 0;">
                        <strong>Progression: ${correct}/${total} cellules (${percentage}%)</strong>
                        <div style="width:100%;height:8px;background:#e0e0e0;border-radius:4px;margin:8px 0;overflow:hidden;">
                            <div style="width:${percentage}%;height:100%;background:linear-gradient(90deg,#ff3075,#a80022);transition:width 0.3s ease;"></div>
                        </div>
                    </div>
                    <button onclick="this.parentNode.remove()" style="background:#ff3075;color:white;border:none;padding:10px 20px;border-radius:5px;cursor:pointer;font-size:16px;margin-top:15px">Continuer</button>
                `;
            }
            
            document.body.appendChild(box);
            
            // Auto-close after 10 seconds if complete
            if (complete) {
                setTimeout(() => {
                    if (box.parentNode) box.remove();
                }, 10000);
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'z': e.preventDefault(); clearGrid(); break;
                    case 'Enter': e.preventDefault(); checkAnswers(); break;
                    case 'h': e.preventDefault(); giveHint(); break;
                    case 'd': e.preventDefault(); toggleTheme(); break;
                }
            }
        });

        // Initialize everything
        document.addEventListener('DOMContentLoaded', () => {
            assignNumbers();
            initGrid();
            createClues();
            
            // Load theme preference
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
            }
            
            // Add tooltips to buttons
            document.querySelector('button[onclick="clearGrid()"]').title = "Ctrl+Z: Effacer toute la grille";
            document.querySelector('button[onclick="checkAnswers()"]').title = "Ctrl+Enter: V√©rifier les r√©ponses";
            document.querySelector('button[onclick="giveHint()"]').title = "Ctrl+H: Obtenir une lettre al√©atoire (maximum 3!)";
            document.querySelector('button[onclick="toggleTheme()"]').title = "Ctrl+D: Basculer le th√®me sombre";
            
            // Welcome message
            setTimeout(() => {
                const welcome = document.createElement('div');
                welcome.style.cssText = `position:fixed;bottom:20px;right:20px;background:#ff3075;color:white;padding:15px 20px;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,0.3);z-index:1000;font-size:14px;animation:fadeIn 0.5s;max-width:300px`;
                welcome.innerHTML = `
                    <strong>üí° Astuces:</strong><br>
                    ‚Ä¢ Cliquez ou utilisez Tab pour changer de direction<br>
                    ‚Ä¢ Survolez les cases pour pr√©visualiser les mots<br>
                    ‚Ä¢ Utilisez les raccourcis clavier (Ctrl+H pour un indice)<br>
                    <button onclick="this.parentNode.remove()" style="background:rgba(255,255,255,0.2);border:none;color:white;padding:5px 10px;border-radius:5px;cursor:pointer;margin-top:10px;float:right;">OK</button>
                `;
                document.body.appendChild(welcome);
                
                setTimeout(() => {
                    if (welcome.parentNode) welcome.remove();
                }, 8000);
            }, 2000);
        });
    </script>
</body>
</html>
