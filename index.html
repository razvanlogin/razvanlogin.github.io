
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDS+ 18/12/2025</title>
    <style>
        body{font-family:'Inter',Arial,sans-serif;max-width:1200px;margin:0 auto;padding:20px;background:#f5f5f5;color:#333;transition:all 0.3s ease}
        h1{text-align:center;margin-bottom:30px;font-size:2.5em;letter-spacing:1px;background:linear-gradient(135deg,#ff3075,#a80022);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
        .controls{text-align:center;margin-bottom:20px;display:flex;justify-content:center;gap:12px;flex-wrap:wrap}
        button{background:#ff3075;color:white;border:none;padding:12px 25px;border-radius:8px;cursor:pointer;font-size:16px;box-shadow:0 4px 8px rgba(0,0,0,0.2);transition:all 0.2s ease;font-weight:500}
        button:hover{background:#a80022;transform:translateY(-2px);box-shadow:0 6px 12px rgba(0,0,0,0.3)}
        button:active{transform:translateY(0);box-shadow:0 2px 4px rgba(0,0,0,0.2)}
        button:disabled{background:#ccc;cursor:not-allowed;transform:none;box-shadow:none}
        .puzzle-container{display:flex;gap:40px;flex-wrap:nowrap;justify-content:center;align-items:flex-start;overflow-x:auto}
        .grid-container,.clues-container{background:white;padding:20px;border-radius:12px;box-shadow:0 5px 15px rgba(0,0,0,0.15);transition:all 0.3s ease}
        .grid-container:hover,.clues-container:hover{box-shadow:0 8px 25px rgba(0,0,0,0.2)}
        .crossword-grid{display:grid;grid-template:repeat(12,45px)/repeat(12,45px);gap:1px;background:#333;border:2px solid #333;border-radius:6px;overflow:hidden;position:relative}
        .cell{background:white;border:none;text-align:center;font-size:18px;font-weight:bold;text-transform:uppercase;position:relative;display:flex;align-items:center;justify-content:center;transition:all 0.15s ease;cursor:pointer}
        .cell:not(.blocked):hover{background:linear-gradient(135deg, #f0f7ff, #e6f3ff);transform:scale(1.02);z-index:2;box-shadow:0 3px 12px rgba(255,48,117,0.15);border-radius:3px}
        .cell:focus{outline:3px solid #ff3075;background:linear-gradient(135deg, #ffe6f2, #ffd9e6);z-index:3;transform:scale(1.02);box-shadow:0 0 0 1px rgba(255,48,117,0.3), 0 4px 16px rgba(255,48,117,0.2)}
        .cell.active{background:linear-gradient(135deg, #ffb3cc, #ff99c2);box-shadow:inset 0 0 0 2px #ff3075, 0 2px 8px rgba(255,48,117,0.25);border-radius:2px}
        .cell.word-highlight{background:linear-gradient(135deg, #fff8fb, #fff0f5);border-radius:2px;box-shadow:0 1px 4px rgba(255,48,117,0.1)}
        .cell.blocked{background:#ff3075;cursor:default;transform:none}
        .cell.blocked:hover{background:#ff3075;transform:none;box-shadow:none}
        .cell.correct{background:linear-gradient(135deg, #d4edda, #c3e6cb);border:2px solid #28a745;box-shadow:0 2px 8px rgba(40,167,69,0.2);border-radius:3px}
        .cell.incorrect{background:linear-gradient(135deg, #f8d7da, #f5c6cb);border:2px solid #dc3545;animation:shake 0.5s;box-shadow:0 2px 8px rgba(220,53,69,0.2);border-radius:3px}
 
 .clues-container{min-width:350px;max-width:450px;flex-shrink:0;display:flex;flex-direction:column;gap:20px;background:white;padding:20px;border-radius:12px;box-shadow:0 5px 15px rgba(0,0,0,0.15);transition:all 0.3s ease}
        .clues-container:hover{box-shadow:0 8px 25px rgba(0,0,0,0.2)}

        .clues-section{flex:1;margin-bottom:0;min-width:0}

        .clues-section h3{margin-bottom:15px;color:#333;border-bottom:2px solid #ff3075;padding-bottom:5px;font-size:1.3em;display:flex;align-items:center;gap:8px}
        .clues-section h3::before{content:'‚Üí';font-size:1.2em;color:#ff3075}
        .clues-section:last-child h3::before{content:'‚Üì'}
        .clue{margin-bottom:6px;padding:6px 10px;cursor:pointer;border-radius:6px;transition:all 0.2s ease;font-size:13px;line-height:1.3;border-left:3px solid transparent;position:relative}
        .clue:hover{background:linear-gradient(135deg, #f0f7ff, #e8f4ff);border-left-color:#ff3075;transform:translateX(6px);box-shadow:0 3px 12px rgba(0,0,0,0.08);border-radius:6px}
        .clue.active{background:linear-gradient(135deg, #ffb3cc, #ff99c2);border-left-color:#ff3075;transform:translateX(6px);box-shadow:0 4px 16px rgba(255,48,117,0.25);border-radius:6px}
        .clue.completed{background:linear-gradient(135deg, #e8f5e8, #d4edda);border-left-color:#28a745;opacity:0.9;box-shadow:0 2px 8px rgba(40,167,69,0.1);border-radius:6px}
        .clue.completed .clue-number{color:#28a745}
        .cell.themed {
                    background:linear-gradient(135deg, #fff2b0, #f5e38c);
                    position:relative;
                    overflow:visible;
                }
        .cell.themed::before {
                    content: '';
                    position: absolute;
                    top: -2px;
                    left: -2px;
                    right: -2px;
                    bottom: -2px;
                    background: linear-gradient(45deg, #ffd700, #ffed4e, #ffd700);
                    border-radius: 3px;
                    z-index: -1;
                    opacity: 0.7;
                }
        .cell.themed:not(.blocked):hover{
                    background:linear-gradient(135deg, #ffed4e, #fff200);
                    transform:scale(1.03);
                    box-shadow:0 4px 16px rgba(255,215,0,0.4);
                }
        .cell.themed:focus{
                    background:linear-gradient(135deg, #ffed4e, #fff200);
                    box-shadow:0 0 0 3px rgba(255,215,0,0.5), 0 4px 20px rgba(255,215,0,0.3);
                }
        
        .clue-number{font-weight:bold;color:#ff3075;margin-right:8px;display:inline-block;min-width:20px}
        .progress-bar{width:100%;height:4px;background:#e0e0e0;border-radius:2px;margin:20px 0;overflow:hidden}
        .progress-fill{height:100%;background:linear-gradient(90deg,#ff3075,#a80022);transition:width 0.3s ease;border-radius:2px}
        .stats{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;font-size:14px;color:#666}
        .cell-wrapper {
          position: relative;
          width: 100%;
          height: 100%;
          background: white;
          display: block; /* changed from flex */
        }
        .cell-wrapper input.cell {
          width: 100%;
          height: 100%;
          border: none;
          padding: 0;
          margin: 0;
          display: block;
        }
        .stat-item{display:flex;flex-direction:column;align-items:center;gap:4px}
        .stat-number{font-size:20px;font-weight:bold;color:#ff3075}
        @keyframes fadeIn{from{opacity:0;transform:translate(-50%,-60%)}to{opacity:1;transform:translate(-50%,-50%)}}
        @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}
        @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
        .confetti{position:fixed;font-size:24px;pointer-events:none;z-index:999;animation:confetti-fall linear infinite}
        @keyframes confetti-fall{0%{transform:translateY(-100vh) rotate(0deg);opacity:1}100%{transform:translateY(100vh) rotate(360deg);opacity:0}}
        .hint-button{background:#28a745;margin-left:8px;padding:8px 16px;font-size:14px}
        .hint-button:hover{background:#218838}
        .cell-number{position:absolute;top:2px;left:3px;font-size:10px;font-weight:bold;color:#ff3075;pointer-events:none;z-index:1;background:rgba(255,255,255,0.9);border-radius:2px;padding:0 2px}
        .timer{font-family:'Courier New',monospace;font-size:18px;font-weight:bold;color:#ff3075}
        
        @media (max-width: 1100px){
            .puzzle-container{
                flex-wrap:wrap;
            }
            .clues-container{
                max-width:800px;
                flex-direction:row;
            }
        }

        @media (max-width: 768px){
            .clues-container{
                flex-direction:column;
                gap:20px;
                max-width:500px;
            }
            .puzzle-container{
                flex-direction:column;
                align-items:center;
                gap:20px;
            }
            .crossword-grid{
                grid-template:repeat(12,35px)/repeat(12,35px)
            }
            .cell{font-size:14px}
            h1{font-size:2em}
        }
    </style>
</head>
<body>
    <h1>______ _____ __ ___ _'_____!! // 18/12/2025</h1>
    
    <div class="stats">
        <div class="stat-item">
            <div class="stat-number" id="completed-words">0</div>
            <div>Mots Compl√©t√©s</div>
        </div>
        <div class="stat-item">
            <div class="timer" id="timer">00:00</div>
            <div>Temps</div>
        </div>
        <div class="stat-item">
            <div class="stat-number" id="hints-left">3</div>
            <div>Indices Restants</div>
        </div>
    </div>
    
    <div class="progress-bar">
        <div class="progress-fill" id="progress" style="width: 0%"></div>
    </div>
    
    <div class="controls">
        <button onclick="clearGrid()">üóëÔ∏è Effacer Tout</button>
        <button onclick="checkAnswers()">‚úì V√©rifier</button>
        <button onclick="giveHint()" class="hint-button" id="hint-button">üí° Indice (3 restants)</button>
     
    </div>
    
    <div class="puzzle-container">
        <div class="grid-container">
            <div class="crossword-grid" id="grid"></div>
        </div>
        <div class="clues-container">
            <div class="clues-section">
                <h3>Horizontalement</h3>
                <div id="across"></div>
            </div>
            <div class="clues-section">
                <h3>Verticalement</h3>
                <div id="down"></div>
            </div>
        </div>
    </div>

    <script>
        const grid = [
            ['B','A','S','E','B','A','L','L','@','C','O','N'],
            ['O','C','T','R','O','I','@','A','M','I','@','D'],
            ['R','@','A','@','N','@','S','I','@','N','B','A'],
            ['D','E','F','I','N','D','A','N','N','E','E','@'],
            ['@','A','F','T','E','R','@','E','@','M','A','T'],
            ['A','U','@','A','S','A','P','@','H','A','U','T'],
            ['V','@','E','L','F','I','Q','U','E','@','T','C'],
            ['A','N','C','I','E','N','@','D','U','N','E','@'],
            ['T','I','R','E','T','@','L','O','R','D','@','S'],
            ['A','@','A','N','E','M','O','N','E','@','T','A'],
            ['R','U','N','@','S','@','G','@','U','B','E','R'],
            ['@','P','S','G','@','C','O','A','X','I','A','L']
        ];

        const clues = [
            {c:"Sport de batte et de gants",a:"BASEBALL",r:0,k:0,d:'across'},
            {c:"R√©union de conspirateurs",a:"CON",r:0,k:9,d:'across'},
            {c:"Obtention d'un PU",a:"OCTROI",r:1,k:0,d:'across'},
            {c:"Copain, pote",a:"AMI",r:1,k:7,d:'across'},
            {c:"Septi√®me note musicale",a:"SI",r:2,k:6,d:'across'},
            {c:"L'association am√©ricaine de basket",a:"NBA",r:2,k:9,d:'across'},
            {c:"MON SECOND",a:"DEFINDANNEE",r:3,k:0,d:'across'},
            {c:"Apr√®s, en anglais",a:"AFTER",r:4,k:1,d:'across'},
            {c:"Qui n'est pas brillant",a:"MAT",r:4,k:9,d:'across'},
            {c:"Symbole chimique de l'or",a:"AU",r:5,k:0,d:'across'},
            {c:"D√®s que possible",a:"ASAP",r:5,k:3,d:'across'},
            {c:"Contraire de bas",a:"HAUT",r:5,k:8,d:'across'},
            {c:"Relatif aux cr√©atures √† oreilles pointues",a:"ELFIQUE",r:6,k:2,d:'across'},
            {c:"T√©l√©conf√©rence (abbrev.)",a:"TC",r:6,k:10,d:'across'},
            {c:"Vieux, antique",a:"ANCIEN",r:7,k:0,d:'across'},
            {c:"Plan√®te d√©sertique de Frank Herbert",a:"DUNE",r:7,k:7,d:'across'},
            {c:"Petit trait horizontal en typographie",a:"TIRET",r:8,k:0,d:'across'},
            {c:"Titre de noblesse britannique",a:"LORD",r:8,k:6,d:'across'},
            {c:"La maison du poisson N√©mo",a:"ANEMONE",r:9,k:2,d:'across'},
            {c:"La tienne",a:"TA",r:9,k:10,d:'across'},
            {c:"Courir, en anglais",a:"RUN",r:10,k:0,d:'across'},
            {c:"Application de service taxi",a:"UBER",r:10,k:8,d:'across'},
            {c:"Club parisien de foot",a:"PSG",r:11,k:1,d:'across'},
            {c:"Comme un c√¢ble TV",a:"COAXIAL",r:11,k:5,d:'across'},
                       
            {c:"Limite, fronti√®re",a:"BORD",r:0,k:0,d:'down'},
            {c:"Anne Calloway (init.)",a:"AC",r:0,k:1,d:'down'},
            {c:"Personnel, √©quipe",a:"STAFF",r:0,k:2,d:'down'},
            {c:"Etienne Robert",a:"ER",r:0,k:3,d:'down'},
            {c:"MON PREMIER",a:"BONNESFETES",r:0,k:4,d:'down'},
            {c:"Artificial intelligence (abbrev.)",a:"AI",r:0,k:5,d:'down'},
            {c:"Pelote pour tricoter",a:"LAINE",r:0,k:7,d:'down'},
            {c:"Salle obscure √† popcorn",a:"CINEMA",r:0,k:9,d:'down'},
            {c:"Non-disclosure agreement (abbrev.)",a:"NDA",r:0,k:11,d:'down'},
            {c:"La sienne",a:"SA",r:2,k:6,d:'down'},
            {c:"H2O",a:"EAU",r:3,k:1,d:'down'},
            {c:"Relatif √† le p√©ninsule en forme de botte",a:"ITALIEN",r:3,k:3,d:'down'},
            {c:"Tuyau d'√©vacuation",a:"DRAIN",r:3,k:5,d:'down'},
            {c:"Toutes taxes comprises (abbrev.)",a:"TTC",r:4,k:11,d:'down'},
            {c:"Film de Peter Jackson avec des gens bleus",a:"AVATAR",r:5,k:0,d:'down'},
            {c:"Papier toilette",a:"PQ",r:5,k:6,d:'down'},
            {c:"Combl√© de joie",a:"HEUREUX",r:5,k:8,d:'down'},
            {c:"Surfaces o√π regarder des films",a:"ECRANS",r:6,k:2,d:'down'},
            {c:"Nouilles japonaises √©paisses",a:"UDON",r:6,k:7,d:'down'},
            {c:"Conjonction n√©gative",a:"NI",r:7,k:1,d:'down'},
            {c:"Nicholas Dupont (init.)",a:"ND",r:7,k:9,d:'down'},
            {c:"Symbole graphique d'une marque",a:"LOGO",r:8,k:6,d:'down'},
            {c:"Soci√©t√© √† responsabilit√© limit√©e (abbrev.)",a:"SARL",r:8,k:11,d:'down'},
            {c:"Th√© en anglais",a:"TEA",r:9,k:10,d:'down'},
            {c:"Unit√© de passage (abbrev.)",a:"UP",r:10,k:1,d:'down'},
            {c:"Pr√©fixe signifiant deux",a:"BI",r:10,k:9,d:'down'}
                        
        ];

        let {across,down} = {across:[],down:[]};
        let activeWord = null, direction = null, typing = false;
        let autoCheckEnabled = false, startTime = Date.now(), timerInterval;
        let completedWords = new Set();

        function assignNumbers() {
            const positions = clues.map(c => ({r:c.r,k:c.k,d:c.d,c})).sort((a,b) => a.r-b.r || a.k-b.k);
            let num = 1;
            const nums = {};
            
            positions.forEach(p => {
                const key = `${p.r},${p.k}`;
                if (!nums[key]) nums[key] = num++;
                (p.d === 'across' ? across : down).push({n:nums[key], ...p.c});
            });
        }

        function addNumbers() {
            [...across, ...down].forEach(c => {
                const cell = document.querySelector(`[data-row="${c.r}"][data-col="${c.k}"]`);
                if (cell && !cell.disabled) {
              
                    const existingNumber = cell.parentElement.querySelector('.cell-number');
                    if (existingNumber) existingNumber.remove();
                    
               
                    const numberDiv = document.createElement('div');
                    numberDiv.className = 'cell-number';
                    numberDiv.textContent = c.n;
                    numberDiv.style.cssText = `
                        position: absolute;
                        top: 2px;
                        left: 3px;
                        font-size: 10px;
                        font-weight: bold;
                        color: #ff3075;
                        pointer-events: none;
                        z-index: 10;
                        background: rgba(255,255,255,0.9);
                        border-radius: 2px;
                        padding: 0 2px;
                    `;
                    
                    
                    cell.parentElement.appendChild(numberDiv);
                    
                   
                    const rect = cell.getBoundingClientRect();
                    const gridRect = cell.parentElement.getBoundingClientRect();
                    numberDiv.style.left = (rect.left - gridRect.left + 3) + 'px';
                    numberDiv.style.top = (rect.top - gridRect.top + 2) + 'px';
                }
            });
        }
        
        
        function initGrid() {
            const g = document.getElementById('grid');
            g.innerHTML = '';

            for (let r = 0; r < 12; r++) {
                for (let k = 0; k < 12; k++) {
                    const c = document.createElement('input');
                    c.type = 'text';
                    c.maxLength = 1;
                    c.className = 'cell';
                    c.dataset.row = r;
                    c.dataset.col = k;

                    if (grid[r][k] === '@') {
                        c.disabled = true;
                        c.classList.add('blocked');
                    } else {
                        c.addEventListener('input', handleInput);
                        c.addEventListener('keydown', handleKey);
                        c.addEventListener('focus', handleFocus);
                        c.addEventListener('mousedown', handleMouse);
                        c.addEventListener('mouseenter', handleHover);
                        c.addEventListener('mouseleave', clearHover);
                    }
                    const wrapper = document.createElement('div');
                    wrapper.className = 'cell-wrapper';
                    wrapper.style.position = 'relative';
                    wrapper.style.width = '100%';
                    wrapper.style.height = '100%';
                    wrapper.appendChild(c);
                    g.appendChild(wrapper);
                }
            }
            addNumbers();
            startTimer();
        }

      

        function handleInput(e) {
            e.target.value = e.target.value.toUpperCase();
            typing = true;
            
            // Auto-check is now always enabled
            const r = +e.target.dataset.row, k = +e.target.dataset.col;
            if (e.target.value && e.target.value !== grid[r][k]) {
                e.target.classList.add('incorrect');
                setTimeout(() => e.target.classList.remove('incorrect'), 1000);
            } else if (e.target.value === grid[r][k]) {
                e.target.classList.add('correct');
                setTimeout(() => e.target.classList.remove('correct'), 1000);
            }
            
            if (e.target.value && activeWord) moveNext(e.target);
            updateStats();
            checkWordCompletion();
        }


        function handleKey(e) {
            const c = e.target;
            const r = +c.dataset.row, k = +c.dataset.col;

            switch(e.key) {
                case 'ArrowRight': e.preventDefault(); typing = false; moveCell(r, k + 1); break;
                case 'ArrowLeft': e.preventDefault(); typing = false; moveCell(r, k - 1); break;
                case 'ArrowDown': e.preventDefault(); typing = false; moveCell(r + 1, k); break;
                case 'ArrowUp': e.preventDefault(); typing = false; moveCell(r - 1, k); break;
                case 'Backspace': if (!c.value) { e.preventDefault(); movePrev(c); } break;
                case 'Tab': e.preventDefault(); typing = false; toggle(r, k); break;
                case ' ': e.preventDefault(); typing = false; toggle(r, k); break;
                default: if (e.key.length === 1) typing = true; break;
            }
        }

        function handleFocus(e) {
            // Only auto-select if not already typing in an active word
            if (typing && activeWord) return;
            
            const r = +e.target.dataset.row, k = +e.target.dataset.col;
            
            // If this cell is already part of the active word, don't change selection
            if (activeWord) {
                const isInActiveWord = direction === 'across' ?
                    (activeWord.r === r && k >= activeWord.k && k < activeWord.k + activeWord.a.length) :
                    (activeWord.k === k && r >= activeWord.r && r < activeWord.r + activeWord.a.length);
                
                if (isInActiveWord) return;
            }
            
            // New cell focused - select horizontal first, then vertical
            const aw = findWord(r, k, 'across'), dw = findWord(r, k, 'down');
            if (aw) {
                highlight(aw, 'across');
            } else if (dw) {
                highlight(dw, 'down');
            } else {
                clearHL();
            }
        }


        function handleMouse(e) {
            const c = e.target, r = +c.dataset.row, k = +c.dataset.col;
            const aw = findWord(r, k, 'across'), dw = findWord(r, k, 'down');
            
            // If clicking on the same cell that's already focused
            if (document.activeElement === c && activeWord) {
                e.preventDefault();
                typing = false;
                // Cycle between available directions
                if (aw && dw) {
                    direction = direction === 'across' ? 'down' : 'across';
                    highlight(direction === 'across' ? aw : dw, direction);
                }
                return;
            }
            
            // New cell clicked - clear old selection and select new
            typing = false;
            if (aw) {
                highlight(aw, 'across');
            } else if (dw) {
                highlight(dw, 'down');
            } else {
                clearHL();
            }
        }

        function handleHover(e) {
            if (activeWord) return;
            const r = +e.target.dataset.row, k = +e.target.dataset.col;
            const aw = findWord(r, k, 'across'), dw = findWord(r, k, 'down');
            const word = aw || dw;
            if (word) {
                const dir = aw ? 'across' : 'down';
                highlightWord(word, dir, 'word-highlight');
            }
        }

        function clearHover() {
            if (activeWord) return;
            document.querySelectorAll('.word-highlight').forEach(e => e.classList.remove('word-highlight'));
        }

        function highlightWord(w, d, className = 'active') {
            for (let i = 0; i < w.a.length; i++) {
                const cr = d === 'across' ? w.r : w.r + i;
                const ck = d === 'across' ? w.k + i : w.k;
                const cell = document.querySelector(`[data-row="${cr}"][data-col="${ck}"]`);
                if (cell) cell.classList.add(className);
            }
        }

        function toggle(r, k) {
            const aw = findWord(r, k, 'across'), dw = findWord(r, k, 'down');
            if (aw && dw) {
                direction = direction === 'across' ? 'down' : 'across';
                highlight(direction === 'across' ? aw : dw, direction);
            } else if (aw) highlight(aw, 'across');
            else if (dw) highlight(dw, 'down');
        }

        function findWord(r, k, d) {
            return (d === 'across' ? across : down).find(w => {
                if (d === 'across') {
                    const end = w.k + w.a.length - 1;
                    return w.r === r && k >= w.k && k <= end;
                } else {
                    const end = w.r + w.a.length - 1;
                    return w.k === k && r >= w.r && r <= end;
                }
            });
        }

        function moveCell(r, k) {
            if (r >= 0 && r < 12 && k >= 0 && k < 12) {
                const c = document.querySelector(`[data-row="${r}"][data-col="${k}"]`);
                if (c && !c.disabled) c.focus();
            }
        }

        function moveNext(c) {
            if (!activeWord) return;
            const r = +c.dataset.row, k = +c.dataset.col;
            const len = activeWord.a.length;

            if (direction === 'across') {
                const end = activeWord.k + len - 1;
                for (let nk = k + 1; nk <= end; nk++) {
                    const nc = document.querySelector(`[data-row="${r}"][data-col="${nk}"]`);
                    if (nc && !nc.value) { nc.focus(); return; }
                }
            } else {
                const end = activeWord.r + len - 1;
                for (let nr = r + 1; nr <= end; nr++) {
                    const nc = document.querySelector(`[data-row="${nr}"][data-col="${k}"]`);
                    if (nc && !nc.value) { nc.focus(); return; }
                }
            }
        }

        function movePrev(c) {
            if (!activeWord) return;
            const r = +c.dataset.row, k = +c.dataset.col;
            if (direction === 'across') {
                if (k > activeWord.k) moveCell(r, k - 1);
            } else {
                if (r > activeWord.r) moveCell(r - 1, k);
            }
        }

        function highlight(w, d) {
            clearHL();
            activeWord = w;
            direction = d;
            highlightWord(w, d);

            const clue = document.querySelector(`.clue[data-n="${w.n}"][data-d="${d}"]`);
            if (clue) {
                clue.classList.add('active');
                clue.scrollIntoView({behavior:'smooth',block:'nearest'});
            }
        }

        function clearHL() {
                    document.querySelectorAll('.active, .word-highlight').forEach(e => e.classList.remove('active', 'word-highlight'));
                    document.querySelectorAll('.clue.active').forEach(e => e.classList.remove('active'));
                    activeWord = null;
                    direction = null;
                    typing = false; // Reset typing state when clearing selection
                }

        function createClues() {
            const ac = document.getElementById('across'), dc = document.getElementById('down');
            ac.innerHTML = dc.innerHTML = '';

            const create = (cs, container, d) => {
                [...cs].sort((a,b) => a.n - b.n).forEach(c => {
                    const div = document.createElement('div');
                    div.className = 'clue';
                    div.dataset.n = c.n;
                    div.dataset.d = d;
                    div.innerHTML = `<span class="clue-number">${c.n}.</span> ${c.c}`;
                    div.addEventListener('click', () => {
                        typing = false;
                        const cell = document.querySelector(`[data-row="${c.r}"][data-col="${c.k}"]`);
                        if (cell) { cell.focus(); highlight(c, d); }
                    });
                    container.appendChild(div);
                });
            };

            create(across, ac, 'across');
            create(down, dc, 'down');
        }

        function checkWordCompletion() {
            [...across, ...down].forEach(word => {
                let isComplete = true;
                for (let i = 0; i < word.a.length; i++) {
                    const r = word.d === 'across' ? word.r : word.r + i;
                    const k = word.d === 'across' ? word.k + i : word.k;
                    const cell = document.querySelector(`[data-row="${r}"][data-col="${k}"]`);
                    if (!cell || cell.value !== word.a[i]) {
                        isComplete = false;
                        break;
                    }
                }
                
                const clue = document.querySelector(`.clue[data-n="${word.n}"][data-d="${word.d}"]`);
                const wordKey = `${word.n}-${word.d}`;
                
                if (isComplete && !completedWords.has(wordKey)) {
                    completedWords.add(wordKey);
                    if (clue) clue.classList.add('completed');
                } else if (!isComplete && completedWords.has(wordKey)) {
                    completedWords.delete(wordKey);
                    if (clue) clue.classList.remove('completed');
                }
            });
        }

        function updateStats() {
            document.getElementById('completed-words').textContent = completedWords.size;
            document.getElementById('hints-left').textContent = 3 - hintCount;
            
            const progress = (completedWords.size / clues.length) * 100;
            document.getElementById('progress').style.width = progress + '%';
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                document.getElementById('timer').textContent =
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function clearGrid() {
            document.querySelectorAll('.cell:not(.blocked)').forEach(c => {
                c.value = '';
                c.classList.remove('correct', 'incorrect');
            });
            clearHL();
            typing = false;
            completedWords.clear();
            document.querySelectorAll('.clue').forEach(c => c.classList.remove('completed'));
            hintCount = 0;
            document.getElementById('hint-button').textContent = 'üí° Indice (3 restants)';
            updateStats();
        }

        function checkAnswers() {
            let complete = true, correct = 0, total = 0;
            
            for (let r = 0; r < 12; r++) {
                for (let k = 0; k < 12; k++) {
                    if (grid[r][k] !== '@') {
                        total++;
                        const c = document.querySelector(`[data-row="${r}"][data-col="${k}"]`);
                        if (!c || !c.value) {
                            complete = false;
                        } else if (c.value === grid[r][k]) {
                            correct++;
                            c.classList.add('correct');
                            setTimeout(() => c.classList.remove('correct'), 2000);
                        } else {
                            complete = false;
                            c.classList.add('incorrect');
                            setTimeout(() => c.classList.remove('incorrect'), 2000);
                        }
                    }
                }
            }
            
            showResult(complete, correct, total);
        }

        let hintCount = 0;

        function giveHint() {
            if (hintCount >= 3) {
                alert("Vous avez utilis√© tous les indices!");
                return;
            }

            const emptyCells = [];
            for (let r = 0; r < 12; r++) {
                for (let k = 0; k < 12; k++) {
                    if (grid[r][k] !== '@') {
                        const cell = document.querySelector(`[data-row="${r}"][data-col="${k}"]`);
                        if (!cell || !cell.value || cell.value !== grid[r][k]) {
                            emptyCells.push({r, k, cell});
                        }
                    }
                }
            }

            if (emptyCells.length > 0) {
                const randomCell = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                randomCell.cell.value = grid[randomCell.r][randomCell.k];
                randomCell.cell.classList.add('correct');
                randomCell.cell.style.animation = 'pulse 0.5s';
                setTimeout(() => {
                    randomCell.cell.classList.remove('correct');
                    randomCell.cell.style.animation = '';
                }, 1000);
                hintCount++;
                
                // Update button text
                const remaining = 3 - hintCount;
                document.getElementById('hint-button').textContent = `üí° Indice (${remaining} restants)`;
                
                checkWordCompletion();
                updateStats();
            }
        }

     

       
        function confetti() {
            const emojis = ['üåû','üèñÔ∏è','‚ú®','üå°Ô∏è','üèñÔ∏è','üèûÔ∏è','üí´','üï∂Ô∏è','ü©¥','‚õ±Ô∏è'];
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const c = document.createElement('div');
                    c.className = 'confetti';
                    c.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    c.style.left = Math.random() * 100 + 'vw';
                    c.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    c.style.animationDelay = Math.random() + 's';
                    c.style.fontSize = (Math.random() * 12 + 18) + 'px';
                    document.body.appendChild(c);
                    setTimeout(() => c.remove(), 6000);
                }, i * 100);
            }
        }

        function markThemedCells() {
            // Find MON PREMIER and MON SECOND clues
            const themedWords = clues.filter(clue =>
                clue.c.includes('MON PREMIER') || clue.c.includes('MON SECOND')
            );
            
            themedWords.forEach(word => {
                // Mark all cells in the themed word
                for (let i = 0; i < word.a.length; i++) {
                    const r = word.d === 'across' ? word.r : word.r + i;
                    const k = word.d === 'across' ? word.k + i : word.k;
                    const cell = document.querySelector(`[data-row="${r}"][data-col="${k}"]`);
                    if (cell) {
                        cell.classList.add('themed');
                    }
                }
            });
        }
        
        function showResult(complete, correct = 0, total = 0) {
            const box = document.createElement('div');
            box.style.cssText = `position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;padding:30px;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,0.3);z-index:1000;text-align:center;font-size:1.2em;animation:fadeIn 0.3s;max-width:400px;border:3px solid #ff3075`;
            
            if (complete) {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                const timeStr = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                box.innerHTML = `
                    <div style="background:linear-gradient(135deg,#ff3075,#a80022);color:white;margin:-30px -30px 20px -30px;padding:20px;border-radius:12px 12px 0 0;">
                        <h2 style="margin:0;font-size:1.5em;">üéâ F√âLICITATIONS ! üéâ</h2>
                    </div>
                    <p><strong>Puzzle compl√©t√© √† 100% !</strong></p>
                    <div style="display:flex;justify-content:space-around;margin:20px 0;font-size:0.9em;">
                        <div><strong>‚è±Ô∏è Temps:</strong><br>${timeStr}</div>
                        <div><strong>üí° Indices:</strong><br>${hintCount}/3</div>
                        <div><strong>‚úÖ Mots:</strong><br>${completedWords.size}/${clues.length}</div>
                    </div>
                    <button onclick="this.parentNode.remove()" style="background:#ff3075;color:white;border:none;padding:12px 24px;border-radius:8px;cursor:pointer;font-size:16px;margin-top:15px;font-weight:bold;box-shadow:0 4px 8px rgba(0,0,0,0.2)">üèÜ Fermer</button>
                `;
                confetti();
                clearInterval(timerInterval);
            } else {
                const percentage = total > 0 ? Math.round((correct / total) * 100) : 0;
                box.innerHTML = `
                    <div style="background:#dc3545;color:white;margin:-30px -30px 20px -30px;padding:20px;border-radius:12px 12px 0 0;">
                        <h3 style="margin:0;">‚ùå Pas encore fini !</h3>
                    </div>
                    <p>La grille contient encore des erreurs ou des cases vides.</p>
                    <div style="margin:15px 0;">
                        <strong>Progression: ${correct}/${total} cellules (${percentage}%)</strong>
                        <div style="width:100%;height:8px;background:#e0e0e0;border-radius:4px;margin:8px 0;overflow:hidden;">
                            <div style="width:${percentage}%;height:100%;background:linear-gradient(90deg,#ff3075,#a80022);transition:width 0.3s ease;"></div>
                        </div>
                    </div>
                    <button onclick="this.parentNode.remove()" style="background:#ff3075;color:white;border:none;padding:10px 20px;border-radius:5px;cursor:pointer;font-size:16px;margin-top:15px">Continuer</button>
                `;
            }
            
            document.body.appendChild(box);
            
            // Auto-close after 10 seconds if complete
            if (complete) {
                setTimeout(() => {
                    if (box.parentNode) box.remove();
                }, 10000);
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'y': e.preventDefault(); clearGrid(); break;
                    case 'Enter': e.preventDefault(); checkAnswers(); break;
                    case 'h': e.preventDefault(); giveHint(); break;
                    
                }
            }
        });

        
        
        // Click outside grid to clear selection
                document.addEventListener('click', (e) => {
                    // Check if click is outside the grid and clues
                    const isGridClick = e.target.closest('.crossword-grid') || e.target.closest('.cell');
                    const isClueClick = e.target.closest('.clue');
                    const isControlClick = e.target.closest('.controls');
                    
                    if (!isGridClick && !isClueClick && !isControlClick) {
                        clearHL();
                        // Also blur any focused input
                        if (document.activeElement && document.activeElement.classList.contains('cell')) {
                            document.activeElement.blur();
                        }
                    }
                });
        
        // Initialize everything
        document.addEventListener('DOMContentLoaded', () => {
            assignNumbers();
            initGrid();
            createClues();
            markThemedCells();
            
            // Add tooltips to buttons
            document.querySelector('button[onclick="clearGrid()"]').title = "Ctrl+Y: Effacer toute la grille";
            document.querySelector('button[onclick="checkAnswers()"]').title = "Ctrl+Enter: V√©rifier les r√©ponses";
            document.querySelector('button[onclick="giveHint()"]').title = "Ctrl+H: Obtenir une lettre al√©atoire (maximum 3!)";
            
            // Welcome message
            setTimeout(() => {
                const welcome = document.createElement('div');
                welcome.style.cssText = `position:fixed;bottom:20px;right:20px;background:#ff3075;color:white;padding:15px 20px;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,0.3);z-index:1000;font-size:14px;animation:fadeIn 0.5s;max-width:300px`;
                welcome.innerHTML = `
                    <strong>üí° Astuces:</strong><br>
                    ‚Ä¢ Cliquez ou utilisez Tab pour changer de direction<br>
                    ‚Ä¢ Survolez les cases pour pr√©visualiser les mots<br>
                    ‚Ä¢ Utilisez les raccourcis clavier (Ctrl+H pour un indice)<br>
                    <button onclick="this.parentNode.remove()" style="background:rgba(255,255,255,0.2);border:none;color:white;padding:5px 10px;border-radius:5px;cursor:pointer;margin-top:10px;float:right;">OK</button>
                `;
                document.body.appendChild(welcome);
                
                setTimeout(() => {
                    if (welcome.parentNode) welcome.remove();
                }, 30000);
            }, 2000);
        });
    </script>
</body>
</html>

